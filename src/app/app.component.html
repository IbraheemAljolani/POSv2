<!-- #HEADER -->
<div class="pos-container" style="overflow: hidden auto;">
    <header id="header">
        <span></span>
        <div class="col-sm-11" style="margin-top:-2px;">

            <!-- POS dropdown-menu-->
            <div class="parameter-context ">

                <div>{{(sysLabels['POS']) ? sysLabels['POS'].Caption : 'POS'}}</div>
                <div class="btn-trans" (click)="openPOSDialog()">
                    <img src="assets/2084-512.webp" />
                    <div>
                        {{ userInfo?.SalesDivision?.DivisionPOSDescription ?
                        userInfo.SalesDivision.DivisionPOSDescription : '---' }}
                    </div>
                </div>

            </div>

            <!-- Customers dropdown-menu-->
            <div class="parameter-context m-l-20">

                <div>{{(sysLabels['Customer']) ? sysLabels['Customer'].Caption : 'Customer'}}</div>
                <div class="btn-trans" title="{{ userInfo?.DefaultCustomer?.CustID ? userInfo?.DefaultCustomer?.CustID : '---' }} - {{
                        userInfo?.DefaultCustomer?.CustomerDescription ? userInfo?.DefaultCustomer?.CustomerDescription :
                        '---'}}" (click)="openCustomerDialog()">
                    <img src="assets/customer.svg" />
                    <div>
                        {{ userInfo?.DefaultCustomer?.CustID ? userInfo.DefaultCustomer.CustID : '---' }} - {{
                        userInfo?.DefaultCustomer?.CustomerDescription ? userInfo.DefaultCustomer.CustomerDescription :
                        '---'}}
                    </div>
                </div>

            </div>

            <!-- tables dropdown-menu-->
            <div class="parameter-context m-l-20" clickOutside (clickOutside)="isDropdownVisible = false">
                <div class="dropdown" style="position:relative">
                    <div>{{(sysLabels['Table'])?sysLabels['Table'].Caption:'Table'}}</div>
                    <div class="dropdown-toggle btn-trans" (click)="toggleDropdownVisible()" title="{{selectedTable}}">
                        <img src="assets/branchtable32.png" />
                        <div>{{selectedTable}}</div>
                        <i class="fa fa-caret-down"></i>
                    </div>
                    <ul class="dropdown-content dropdown-menu  table-responsive custom-scroll mx-height-300"
                        [ngStyle]="{'display': isDropdownVisible ? 'block' : 'none'}">
                        <li *ngFor="let tbl of branchTables">
                            <a href="javascript:void(0);" (click)="setTable(tbl)">
                                {{tbl.ID}} - {{tbl.Description}}
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- salesmen dropdown-menu-->
            <div class="parameter-context m-l-20" (click)="selectSalesMan()">

                <div>{{(sysLabels['Sales Man'])?sysLabels['Sales Man'].Caption:'Sales Man'}}</div>
                <div class="btn-trans" [title]="salesManName ? salesManID + ' - ' + salesManName : ''">
                    <ng-container *ngIf="salesManName; else noSalesMan">
                        <img src="assets/anonymous.png" />
                        <div>{{salesManID}} - {{salesManName}}</div>
                    </ng-container>

                    <ng-template #noSalesMan>
                        <img src="assets/salesman32.png" />
                        <div>...</div>
                        <i class="fa fa-search border-left"></i>
                    </ng-template>
                </div>

            </div>

            <!-- deliveryDate datepicker-->
            <div class="parameter-context m-l-20 ">

                <div>{{(sysLabels['Delivery Date'])?sysLabels['Delivery Date'].Caption:'Delivery Date'}}
                </div>
                <div class="btn-trans" (click)="deliveryDateDatepicker.open()">
                    <i class="fa fa-calendar-plus-o"></i>
                    <mat-datepicker #deliveryDateDatepicker></mat-datepicker>
                    <input [matDatepicker]="deliveryDateDatepicker" readonly placeholder="MM/dd/yyyy"
                        style="min-width:0;background:none;border:0; cursor:pointer;">
                </div>

            </div>

            <!-- deliveryDate Timeepicker-->
            <div class="parameter-context m-l-20">
                <div>{{(sysLabels['Delivery Time'])?sysLabels['Delivery Time'].Caption:'Delivery Time'}}
                </div>
                <div class="btn-trans">
                    <i class="fa fa-clock-o"></i>
                    <input style="border: 0; background: transparent; cursor: pointer;width:100%"
                        [ngxTimepicker]="deliveryTimePicker" placeholder="00:00 am" readonly>
                    <ngx-material-timepicker style="z-index:1000000 !important"
                        #deliveryTimePicker></ngx-material-timepicker>
                </div>
            </div>

            <!-- cash on delivery -->
            <div class="parameter-context m-t-5 m-l-20">

                <div
                    title="{{(sysLabels['Cash On Delivery'])?sysLabels['Cash On Delivery'].Caption:'Cash On Delivery'}}">
                    {{(sysLabels['COD']) ? sysLabels['COD'].Caption : 'COD'}}
                </div>
                <div>
                    <input type="checkbox" />
                </div>
            </div>

            <!-- Direct print (without showing print pop window) -->
            <div class="parameter-context m-t-5 m-l-20">

                <div title="{{(sysLabels['Direct Print'])?sysLabels['Direct Print'].Caption:'Direct Print'}}">
                    {{(sysLabels['DP']) ? sysLabels['DP'].Caption : 'DP'}}
                </div>
                <div>
                    <input type="checkbox" />
                </div>
            </div>

        </div>

        <!-- pulled right: nav area -->
        <div class="pull-right">

            <!-- logout button -->
            <div id="logout" class="btn-header transparent pull-right visible-xs">
                <span>
                    <a href="javascript:void(0)" title="Sign Out" data-action="userLogout"
                        data-logout-msg="You can improve your security further after logging out by closing this opened browser">
                        <i class="fa fa-sign-out"></i>
                    </a>
                </span>
            </div>
            <!-- end logout button -->

            <span id="fullscreen" class="btn-header m-r-10" style="cursor: pointer;" (click)="changeLanguage()">
                <span>
                    <a href="javascript:void(0);" data-action="launchLanguage" title="Language">
                        {{currentLanguage == 1 ? 'EN' : 'AR'}}
                    </a>
                </span>
            </span>

            <!-- fullscreen button -->
            <span id="fullscreen" class="btn-header transparent">
                <span>
                    <a href="javascript:void(0);" data-action="launchFullscreen" (click)="toggleFullscreen()"
                        title="Full Screen">
                        <i class="fa fa-arrows-alt"></i>
                    </a>
                </span>
            </span>

            <span class="header-profile hidden-xs">
                <a href="javascript:void(0);" id="show-shortcut" class="dropdown-toggle" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                    <img [src]="userInfo.Employee?.Image ? 'data:image/jpeg;base64,' + userInfo.Employee.Image : 'assets/anonymous.png'"
                        (error)="userInfo.Employee.Image = 'assets/anonymous.png'" alt="me" />
                </a>
            </span>

        </div>
        <!-- end pulled right: nav area -->

    </header>

    <!-- END HEADER -->
    <!-- #NAVIGATION -->
    <!-- END NAVIGATION -->
    <!-- #MAIN PANEL -->
    <div class="pos-body">
        <div class="side-list">
            <ul>
                <li [class.active]="activeInvoiceTab === 'invoice'" (click)="goTab('invoice')">
                    <a data-toggle="tab" class="pointer" title="Invoice">
                        <i class="fa fa-file"></i>
                        <br />
                        <span class="hidden-sm hidden-xs">
                            {{(sysLabels['Invoice']) ? sysLabels['Invoice'].Caption : 'Invoice'}}
                        </span>
                    </a>
                </li>
                <li [class.active]="activeInvoiceTab === 'promo'" (click)="goTab('promo')">
                    <a data-toggle="tab" class="pointer" title="Promotion">
                        <i class="fa fa-snowflake-o"></i>
                        <br />
                        <span class="hidden-sm hidden-xs">
                            {{(sysLabels['Promo']) ? sysLabels['Promo'].Caption : 'Promo'}}
                        </span>
                    </a>
                </li>
                <li [class.active]="activeInvoiceTab === 'cash'" (click)="goTab('cash')">
                    <a data-toggle="tab" class="pointer" title="Cash">
                        <i class="fa fa-money"></i>
                        <br />
                        <span class="hidden-sm hidden-xs">
                            {{(sysLabels['Billing']) ? sysLabels['Billing'].Caption : 'Billing'}}
                        </span>
                    </a>
                </li>
                <li [class.active]="activeInvoiceTab === 'recall'" (click)="goTab('recall')">
                    <a data-toggle="tab" class="pointer" title="ReCall">
                        <i class="fa fa-share"></i>
                        <br />
                        <span class="hidden-sm hidden-xs">
                            {{(sysLabels['Recall']) ? sysLabels['Recall'].Caption : 'Recall'}}
                        </span>
                    </a>
                </li>
            </ul>
        </div>
        <div role="main" style="height:100%;flex:1;">

            <!-- RIBBON --> <!--//emad-->
            <div id="ribbon" class="ribbon-inside">
                <div class="m-t-5">

                    <span>
                        <strong>
                            {{(sysLabels['Division'])?sysLabels['Division'].Caption:'Division'}}:
                        </strong>
                        <span>{{userInfo.SalesDivision?.DivisionDescription}}</span>
                    </span>
                    <span>
                        <strong>
                            {{(sysLabels['Site'])?sysLabels['Site'].Caption:'Site'}}:
                        </strong>
                        <span>{{userInfo.SalesDivision?.SiteDescription}}</span>
                    </span>
                    <span>
                        <strong>
                            {{(sysLabels['Store'])?sysLabels['Store'].Caption:'Store'}}:
                        </strong>
                        <span>{{userInfo.SalesDivision?.StoreDescription}}</span>
                    </span>
                    <span>
                        <strong>
                            {{(sysLabels['Cashier'])?sysLabels['Cashier'].Caption:'Cashier'}}:
                        </strong>
                        <span>{{userInfo.SalesDivision?.CashierDescription}}</span>
                    </span>

                </div>
            </div>
            <!-- END RIBBON -->

            <div id="pos-content">
                <div class="row">
                    <div class="col-sm-5 pos-content-left">
                        <div class="trio-window trio-window-color-blue">
                            <header>

                                <h3>
                                    <span style="white-space:nowrap" *ngIf="selectedInvoice">
                                        <span class="hidden-sm hidden-xs">
                                            {{(sysLabels['Invoice']) ? sysLabels['Invoice'].Caption :
                                            'Invoice'}}
                                        </span>
                                        {{selectedInvoice.ID}}
                                    </span>

                                    <span *ngIf="!selectedInvoice" style="color:#ddd">
                                        {{(sysLabels['No Invoice']) ? sysLabels['No Invoice'].Caption :
                                        'No Invoice'}}
                                    </span>

                                </h3>

                                <div class="trio-window-ctrls" *ngIf="selectedInvoice">

                                    <a class="button-icon pointer" title="Print" aria-label="Print"
                                        (click)="printPage()">
                                        <i class="fa fa-print invoice-icon" aria-hidden="true"></i>
                                    </a>
                                    <a class="button-icon pointer" (click)="RetailInvoice_Void()"
                                        title="Void (Shift + v)" aria-label="Void">
                                        <i class="fa fa-window-close-o txt-color-dangerLight invoice-icon"
                                            aria-hidden="true"></i>
                                    </a>
                                    <a class="button-icon pointer" (click)="addNewInvoice()" aria-label="New">
                                        <i class="fa fa-plus invoice-icon" aria-hidden="true"></i>
                                    </a>
                                </div>
                                <div class="widget-toolbar hidden-sm hidden-xs" role="menu" style="cursor:default">
                                    <div class="label" *ngIf="selectedInvoice"
                                        [ngStyle]="{'background-color': getColor(selectedInvoice.SalesInvoiceStatusID)}">
                                        {{(sysLabels[selectedInvoice.SalesInvoiceStatusID])?sysLabels[selectedInvoice.SalesInvoiceStatusID].Caption:selectedInvoice.SalesInvoiceStatusID}}
                                    </div>
                                </div>

                            </header>

                            <div class="column-flex full-flex" style="max-height: calc(100% - 34px);">
                                <div class="widget-body-toolbar"
                                    *ngIf="activeInvoiceTab !== 'recall' && selectedInvoice">
                                    <div class="text-muted">
                                        <small>{{(sysLabels['Code'])?sysLabels['Code'].Caption:'Code'}}:
                                            {{selectedInvoice.Code}}</small>

                                        <small class="pull-right">{{selectedInvoice.SalesInvoiceDate | date:
                                            'MM-dd-yyyy'}}</small>
                                    </div>
                                </div>

                                <div class="widget-body no-padding column-flex"
                                    style="height:100%;height: calc(100% - 37px);">
                                    <div class="tab-content padding-10 column-flex full-flex">
                                        <!--Invoice-->
                                        <div class="tab-pane table-responsive custom-scroll"
                                            [ngClass]="{'active in':activeInvoiceTab === 'invoice'}">

                                            <div *ngFor="let product of selectedInvoiceProducts">
                                                <div class="s-item-list m-t-15" *ngIf="selectedInvoice">
                                                    <div class="p-5-10">
                                                        <strong>{{ product.Description }}</strong>

                                                        <div class="s-price-details">
                                                            <span class="s-price-details">

                                                                <div class="btn-flat" data-toggle="dropdown"
                                                                    [style.pointer-events]="selectedInvoice.SalesInvoiceStatusID === 'Printed' ? 'none' : 'auto' && selectedInvoice.SalesInvoiceStatusID === 'Rejected' ? 'none' : 'auto'"
                                                                    (click)="updateProductQuantity(product, true)">
                                                                    <i class="fa fa-plus txt-color-green"></i>
                                                                </div>

                                                                <div class="btn-flat"
                                                                    [style.pointer-events]="selectedInvoice.SalesInvoiceStatusID === 'Printed' ? 'none' : 'auto' && selectedInvoice.SalesInvoiceStatusID === 'Rejected' ? 'none' : 'auto'"
                                                                    (click)="updateProductQuantity(product, false)">

                                                                    <i class="fa fa-minus txt-color-dangerLight"></i>
                                                                </div>

                                                                <input
                                                                    style='font-weight:bold; border-radius: 30px 0 0 30px;'
                                                                    [style.pointer-events]="selectedInvoice.SalesInvoiceStatusID === 'Printed' ? 'none' : 'auto' && selectedInvoice.SalesInvoiceStatusID === 'Rejected' ? 'none' : 'auto'"
                                                                    class="input-left-rounded" [ngModel]="product.Qty"
                                                                    (keyup)="adjustInputWidth($event, product)"
                                                                    type="number" />

                                                                <div class="btn btn-xs width-40 disabled btn-default-gray"
                                                                    [style.pointer-events]="isDisabled ? 'none' : 'auto'"
                                                                    style="color: #000;">
                                                                    {{product.UOMDescription}}
                                                                </div>

                                                            </span>

                                                            <span class="pull-right bold m-t-5" title="Total Product">
                                                                {{product.NetTotalAfterTax}}
                                                                &nbsp;
                                                                {{product.CurrencyID}}
                                                            </span>

                                                        </div>
                                                        <div class="item-controls">
                                                            <a role="button" class="pointer" title="Remove"
                                                                *ngIf="selectedInvoice.SalesInvoiceStatusID == 'Created'"
                                                                aria-label="Remove">
                                                                <i (click)="deleteProductFromCart(product)"
                                                                    class="fa fa-trash txt-color-dangerLight"
                                                                    aria-hidden="true">
                                                                </i>
                                                            </a>


                                                            <a role="button" NgClass="pointer" class="pointer"
                                                                (click)="openDetails(product)" title="Show more"
                                                                aria-label="Show more">
                                                                <i class="fa fa-arrows-alt txt-color-green"
                                                                    aria-hidden="true"></i>
                                                            </a>
                                                        </div>
                                                    </div>

                                                    <table class="table-condensed table-striped" *ngIf="product.opened">

                                                        <tr>
                                                            <td>{{(sysLabels['Tax'])?sysLabels['Tax'].Caption:'Tax'}}
                                                            </td>
                                                            <td>
                                                                <i class="fa fa-caret-right m-r-5"
                                                                    aria-hidden="true"></i>
                                                                {{(sysLabels['Amount'])?sysLabels['Amount'].Caption:'Amount'}}:
                                                                {{product.TaxAmount}}
                                                            </td>
                                                            <td>%</td>
                                                        </tr>

                                                        <tr>
                                                            <td>{{(sysLabels['Promo'])?sysLabels['Promo'].Caption:'Promo'}}
                                                            </td>
                                                            <td>
                                                                <i class="fa fa-caret-right m-r-5"
                                                                    aria-hidden="true"></i>
                                                                {{(sysLabels['ID'])?sysLabels['ID'].Caption:'ID'}}:
                                                                ---
                                                            </td>
                                                            <td>{{(sysLabels['Discount'])?sysLabels['Discount'].Caption:'Discount'}}:
                                                                ---
                                                            </td>
                                                        </tr>

                                                        <tr>
                                                            <td>
                                                                {{(sysLabels['Promo Notes'])?
                                                                sysLabels['Promo Notes'].Caption:'Promo Notes'}}
                                                            </td>
                                                            <td colspan="2">
                                                                <i class="fa fa-caret-right m-r-5"
                                                                    aria-hidden="true"></i>
                                                                ---
                                                            </td>
                                                        </tr>

                                                        <tr>
                                                            <td>
                                                                {{(sysLabels['Discount'])?sysLabels['Discount'].Caption:'Discount'}}/{{(sysLabels['Unit'])?sysLabels['Unit'].Caption:'Unit'}}
                                                            </td>
                                                            <td>
                                                                <i class="fa fa-caret-right m-r-5"
                                                                    aria-hidden="true"></i>
                                                                <input type="number" class="input-rounded"
                                                                    [ngModel]="product.DiscountPercentage" />
                                                                <strong>%</strong>
                                                            </td>
                                                            <td>
                                                                <input type="number" class="input-rounded"
                                                                    [ngModel]="product.DiscountPerUnit" />
                                                                <strong>$</strong>
                                                            </td>
                                                        </tr>

                                                        <tr>
                                                            <td>{{(sysLabels['Total Discount'])?
                                                                sysLabels['Total Discount'].Caption:'Total Discount'}}
                                                            </td>
                                                            <td>
                                                                <i class="fa fa-caret-right m-r-5"
                                                                    aria-hidden="true"></i>
                                                                {{product.TotalDiscount}}
                                                            </td>
                                                            <td></td>
                                                        </tr>

                                                        <tr>
                                                            <td>
                                                                {{(sysLabels['TotalAmountAfterDiscount'])?sysLabels['TotalAmountAfterDiscount'].Caption:'TotalAmountAfterDiscount'}}
                                                            </td>
                                                            <td colspan="2">
                                                                <i class="fa fa-caret-right m-r-5"
                                                                    aria-hidden="true"></i>
                                                                {{product.NetTotalAfterDiscount}}
                                                                &nbsp;
                                                                {{product.CurrencyID}}
                                                            </td>
                                                        </tr>

                                                    </table>
                                                </div>
                                            </div>
                                        </div>

                                        <!--promo-->
                                        <div class="tab-pane" [ngClass]="{'active in':activeInvoiceTab === 'promo'}">
                                            <div class="column-flex" *ngIf="selectedInvoice">
                                                <div>
                                                    <div class="p-5-10">
                                                        <label>
                                                            <input type="checkbox" class="checkbox style-0"
                                                                [(ngModel)]="promoSelectAllFlag"
                                                                (change)="promoSelectAll()">
                                                            <span>
                                                                <ng-container
                                                                    *ngIf="promoSelectAllFlag; else noSelectAll">
                                                                    {{(sysLabels['Deselect All Promotions'])?
                                                                    sysLabels['Deselect All Promotions'].
                                                                    Caption:'Deselect All Promotions'}}
                                                                </ng-container>
                                                                <ng-template #noSelectAll>
                                                                    {{(sysLabels['Select All Promotions'])?
                                                                    sysLabels['Select All Promotions'].
                                                                    Caption:'Select All Promotions'}}
                                                                </ng-template>
                                                            </span>
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="table-responsive custom-scroll full-flex">
                                                    <div class="s-item-list" *ngFor="let item of promosList">
                                                        <div class="p-5-10">
                                                            <label>
                                                                <input type="checkbox" class="checkbox style-0"
                                                                    [(ngModel)]="item.SelectFlag">
                                                                <span> {{item.ID}} - {{item.Description}}</span>
                                                            </label>

                                                            <div class="m-t-5 m-b-5">
                                                                <small class="text-muted">
                                                                    <strong>{{(sysLabels['Type'])?sysLabels['Type'].Caption:'Type'}}:
                                                                    </strong> {{item.ReferenceType}}
                                                                </small>

                                                                <span class="pull-right">
                                                                    {{(sysLabels['Discount'])?sysLabels['Discount'].Caption:'Discount'}}:
                                                                    <strong> ---</strong>
                                                                </span>
                                                            </div>

                                                            <div class="item-controls">
                                                                <a role="button" class="pointer" title="Show more"
                                                                    (click)="expandArea(item)" aria-label="Show more">
                                                                    <i class="fa fa-arrows-alt txt-color-green"></i>
                                                                </a>
                                                            </div>
                                                        </div>

                                                        <table class="table-condensed table-striped"
                                                            *ngIf="item.opened">
                                                            <tr>
                                                                <td>
                                                                    {{(sysLabels['SalesInvoice'])?sysLabels['SalesInvoice'].Caption:'SalesInvoice'}}
                                                                </td>
                                                                <td>{{ selectedInvoice.ID ? selectedInvoice.ID :
                                                                    '---'
                                                                    }}</td>
                                                                <td>
                                                                    <strong>{{(sysLabels['PromotionID'])?sysLabels['PromotionID'].Caption:'PromotionID'}}</strong>
                                                                </td>
                                                                <td>{{item.ID}}</td>
                                                            </tr>

                                                            <tr>
                                                                <td>
                                                                    {{(sysLabels['BenefitQty'])?sysLabels['BenefitQty'].Caption:'BenefitQty'}}
                                                                </td>
                                                                <td> ---</td>
                                                                <td>
                                                                    <strong>{{(sysLabels['Minimum Qty'])?
                                                                        sysLabels['Minimum Qty'].
                                                                        Caption:'Minimum Qty'}}</strong>
                                                                </td>
                                                                <td> ---</td>
                                                            </tr>
                                                            <tr>
                                                                <td>{{(sysLabels['Note'])?sysLabels['Note'].Caption:'Note'}}
                                                                </td>
                                                                <td colspan="3"> ---</td>
                                                            </tr>

                                                        </table>
                                                    </div>

                                                    <div class="no-data" *ngIf="promosList.length === 0">No Data</div>
                                                </div>

                                            </div>
                                        </div>

                                        <!--Cash -->
                                        <div class="tab-pane" [ngClass]="{'active in':activeInvoiceTab === 'cash'}"
                                            style="max-height: 645px;">
                                            <div *ngIf="selectedInvoice">
                                                <div class="row"
                                                    style="display: flex; justify-content: center; padding: 0 40px;">
                                                    <table class=" col-lg-2  payment-methods-tbl" style="width: 0; ">
                                                        <tr>
                                                            <td *ngFor="let methods of receiptMethods">
                                                                <label role="button"
                                                                    (click)="collectMethodDetails(methods.MethodTypeID, methods.Description, methods)">
                                                                    <img alt="MethodType"
                                                                        [src]="'data:image/jpeg;base64,' + methods.Image ? 'data:image/jpeg;base64,' + methods.Image : 'assets/customer.svg'"
                                                                        (error)="methods.Image = 'assets/default.webp'" />
                                                                    <br />
                                                                    {{methods.Description}}
                                                                </label>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>

                                                <div class="text-center" *ngIf="receiptMethods.length == 0">No payment
                                                    methods are defined!</div>

                                                <div class="table-responsive custom-scroll">

                                                    <div class="s-item-list"
                                                        *ngFor="let item of selectedPayments;let first = first">
                                                        <div class="p-5-10" (click)="expandArea(item)">
                                                            <div class="input-group input-group-rounded"
                                                                title="{{(item.ReceiptMethodTypeID == 'Card')?'InvoiceID':(item.ReceiptMethodTypeID == 'Loyalty Card' || item.ReceiptMethodTypeID == 'Coupon')?'Card number':'Value'}}">
                                                                <ng-container
                                                                    *ngIf="item.ReceiptMethodTypeID == 'Cash'; else defaultPayments">
                                                                    <span class="input-group-addon"
                                                                        [ngSwitch]="item.ReceiptMethodTypeID">
                                                                        <i class="fa fa-money" aria-hidden="true"></i>
                                                                    </span>
                                                                    <input type="number" class="form-control" disabled
                                                                        [ngModel]="item.Amount" />
                                                                </ng-container>
                                                                <ng-template #defaultPayments>
                                                                    <span class="input-group-addon"
                                                                        [ngSwitch]="item.ReceiptMethodTypeID">
                                                                        <i class="fa fa-credit-card"
                                                                            aria-hidden="true"></i>
                                                                    </span>
                                                                    <input type="number" class="form-control" disabled
                                                                        [ngModel]="item.Amount" />
                                                                </ng-template>
                                                            </div>

                                                            <div class="m-t-10 m-b-5 m-l-5">
                                                                <small class="text-muted">
                                                                    <span>
                                                                        <strong>{{(sysLabels[item.ReceiptMethodTypeID])
                                                                            ?
                                                                            sysLabels[item.ReceiptMethodTypeID].Caption
                                                                            : item.ReceiptMethodTypeID}}</strong>
                                                                    </span>
                                                                    -
                                                                    <span>{{item.invoiceDate |
                                                                        date: 'MM/dd/yyyy HH:mm'}}</span>
                                                                </small>

                                                            </div>
                                                        </div>
                                                        <div class="item-controls">
                                                            <a role="button"
                                                                *ngIf="selectedInvoice.SalesInvoiceStatusID != 'Printed'"
                                                                class="pointer m-r-15" title="Delete"
                                                                (click)="deletePayment(item)" aria-label="Delete">
                                                                <i class="fa fa-trash txt-color-dangerLight"></i>
                                                            </a>
                                                            <a role="button" class="pointer" title="Show more"
                                                                aria-label="Show more" (click)="expandArea(item)">
                                                                <i class="fa fa-arrows-alt txt-color-green"></i>
                                                            </a>
                                                        </div>
                                                        <table class="table-condensed table-striped"
                                                            *ngIf="item.opened && item.ReceiptMethodTypeID == 'Return Invoice'">
                                                            <tr>
                                                                <td>
                                                                    Invoice Amount
                                                                </td>
                                                                <td colspan="2">
                                                                    <i class="fa fa-caret-right m-r-5"
                                                                        aria-hidden="true"></i>
                                                                    Amount value
                                                                </td>
                                                            </tr>

                                                            <tr>
                                                                <td>Amount</td>
                                                                <td>
                                                                    <i class="fa fa-caret-right m-r-5"
                                                                        aria-hidden="true"></i>
                                                                    Available: AvailableAmount value
                                                                </td>
                                                                <td>
                                                                    Returned: ReturnedAmount value
                                                                </td>
                                                            </tr>
                                                        </table>
                                                        <table class="table-condensed" *ngIf="item.opened"
                                                            style="background-color:#fafafa">
                                                            <tr>
                                                                <td>
                                                                    {{(sysLabels['Description'])?sysLabels['Description'].Caption:'Description'}}
                                                                </td>
                                                                <td colspan="2">
                                                                    <i class="fa fa-caret-right m-r-5"
                                                                        aria-hidden="true"></i>
                                                                    {{item.Description? item.Description : ''}}
                                                                </td>
                                                            </tr>

                                                            <tr>
                                                                <td colspan="3">
                                                                    <textarea class="inline-select"
                                                                        [(ngModel)]="item.Note"
                                                                        placeholder="{{(sysLabels['Notes']) ? sysLabels['Notes'].Caption : 'Notes'}}"
                                                                        style="height:50px;font-weight:normal">
                                                                    </textarea>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!--recall-->
                                        <div class="tab-pane" style="height:calc(100% + 36px)"
                                            [ngClass]="{'active in':activeInvoiceTab === 'recall'}">

                                            <div class="column-flex">
                                                <div>
                                                    <div class="row m-b-15">
                                                        <div class="col-sm-6 m-t-5"
                                                            *ngIf="filterRecallSearch.includes('date')">
                                                            <div class="input-group input-group-sm">
                                                                <input type="text" style="cursor: not-allowed;" readonly
                                                                    [matDatepicker]="myDatepicker"
                                                                    placeholder="{{(sysLabels['Search by Date']) ? sysLabels['Search by Date'].Caption : 'Search by Date'}}"
                                                                    [(ngModel)]="datepicker"
                                                                    (ngModelChange)="changeDate($event)"
                                                                    class="form-control">
                                                                <span class="input-group-btn">
                                                                    <button class="btn btn-default-gray" type="button"
                                                                        (click)="myDatepicker.open();">
                                                                        <span class="fa fa-calendar fa-fw"></span>
                                                                    </button>
                                                                </span>
                                                                <mat-datepicker #myDatepicker></mat-datepicker>
                                                            </div>
                                                        </div>

                                                        <div class="col-sm-6 m-t-5">
                                                            <div class="input-group input-group-sm">
                                                                <input #searchInput type="text"
                                                                    placeholder="{{(sysLabels['Search by ID Text'])?sysLabels['Search by ID Text'].Caption:'Search by ID/Text'}}"
                                                                    class="form-control"
                                                                    (keyup.enter)="searchRecall(searchInput.value)">
                                                                <span class="input-group-btn">
                                                                    <button class="btn btn-success" type="button"
                                                                        (click)="searchRecall(searchInput.value)">{{(sysLabels['Search'])?sysLabels['Search'].Caption:'Search'}}!</button>
                                                                </span>
                                                            </div>
                                                        </div>

                                                        <div class="row filter-container">
                                                            <label *ngFor="let filter of filters"
                                                                [style.color]="filter.color" class="filter-label">
                                                                <input type="checkbox" class="checkbox style-0"
                                                                    [checked]="filter.checked"
                                                                    (change)="toggleFilter(filter)">
                                                                <span>{{(sysLabels[filter.label])
                                                                    ?
                                                                    sysLabels[filter.label].Caption
                                                                    : filter.label}}</span>
                                                            </label>
                                                        </div>

                                                    </div>
                                                </div>
                                                <div style="overflow-y: scroll;">
                                                    <div class="custom-scroll full-flex"
                                                        *ngFor="let invoices of retailInvoices">
                                                        <div class="s-item-list">
                                                            <div class="p-5-10">
                                                                <i class="fa fa-stop fa-stop-style"
                                                                    [ngStyle]="{'color': getColor(invoices.SalesInvoiceStatusID)}"
                                                                    aria-hidden="true">
                                                                </i>
                                                                <strong>{{invoices.ID}}</strong> -
                                                                {{invoices.CustDescription}}
                                                                <div class="s-price-details">
                                                                    <small class="text-muted">
                                                                        <span class="input-rounded"
                                                                            title="Invoice Code">
                                                                            {{invoices.Code}}
                                                                        </span>
                                                                        -
                                                                        <span title="Invoice Date">
                                                                            {{ invoices.SalesInvoiceDate |
                                                                            date:'MM/dd/yyyy'
                                                                            }} </span>

                                                                    </small>

                                                                    <span class="pull-right bold m-t-5"
                                                                        title="Net Total After Tax">
                                                                        {{invoices.NetTotalAfterTax}}
                                                                        {{invoices.CurrencyID}}
                                                                    </span>

                                                                </div>
                                                            </div>
                                                            <div class="item-controls  m-t-5">
                                                                <a role="button" class="pointer" title="Open Invoice"
                                                                    aria-label="Open Invoice">
                                                                    <i class="fa fa-external-link txt-color-green fa-lg"
                                                                        (click)="invoiceDetails(invoices)"></i>
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!--this tab will be shown  when no invoice-->
                                        <div *ngIf="!selectedInvoice && activeInvoiceTab !== 'recall'">
                                            <div class="text-center" style="position: relative; bottom: 300px;">
                                                <a class="btn-lg m-t-50" style="text-decoration: none; ">
                                                    {{currentLanguage == 1 ? 'Select Your First Product to Invoice' :
                                                    'حدد منتجك الأول لفاتورة'}}
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="widget-footer" *ngIf="activeInvoiceTab !== 'recall' && selectedInvoice"
                                        style="margin-bottom:-13px">
                                        <div class="row">
                                            <div class="col-sm-3" style="z-index:2">
                                                <button type="button" (click)="goTab('cash')"
                                                    *ngIf="activeInvoiceTab === 'invoice' && selectedInvoice.SalesInvoiceStatusID != 'Printed'"
                                                    class="btn btn-success m-t-10 m-l-5 pull-left">
                                                    <i class="fa fa-chevron-left m-r-5" aria-hidden="true"></i>
                                                    {{(sysLabels['Check Out Invoice'])?
                                                    sysLabels['Check Out Invoice'].
                                                    Caption:'Check Out Invoice'}}
                                                </button>

                                                <button type="button" *ngIf="activeInvoiceTab === 'promo'"
                                                    class="btn btn-success m-t-10 m-l-5 pull-left">
                                                    <i class="fa fa-chevron-left m-r-5" aria-hidden="true"></i>
                                                    {{(sysLabels['Apply'])?sysLabels['Apply'].Caption:'Apply'}}
                                                </button>

                                                <button type="button" *ngIf="activeInvoiceTab === 'promo'"
                                                    class="btn btn-danger m-t-10 m-l-5 pull-left">
                                                    <i class="fa fa-eraser m-r-5" aria-hidden="true"></i>
                                                    {{(sysLabels['Clear'])?sysLabels['Clear'].Caption:'Clear'}}
                                                </button>

                                                <button (click)="postCash()" type="button"
                                                    *ngIf="activeInvoiceTab === 'cash'"
                                                    class="btn btn-success m-t-10 m-l-5 pull-left">
                                                    <i class="fa fa-money m-r-5" aria-hidden="true"></i>
                                                    {{(sysLabels['Done'])?sysLabels['Done'].Caption:'Done'}}
                                                </button>
                                            </div>

                                            <div class="col-sm-9">
                                                <ul class="" id="sparks">
                                                    <li class="sparks-info">
                                                        <h5 style="margin:0;"> {{(sysLabels['Net Total'])?
                                                            sysLabels['Net Total'].Caption:'Net Total'}}
                                                            <span class="txt-color-blue">
                                                                <i class="fa fa-money"></i>
                                                                &nbsp; {{selectedInvoice.NetTotalAfterTax}}
                                                            </span>
                                                        </h5>
                                                    </li>
                                                    <li class="sparks-info">
                                                        <h5 style="margin:0;">
                                                            {{(sysLabels['TotalPayment'])?sysLabels['TotalPayment'].Caption:'TotalPayment'}}
                                                            <span class="txt-color-purple">
                                                                <i class="fa fa-check"></i>
                                                                &nbsp;{{totalAmount}}
                                                            </span>
                                                        </h5>

                                                    </li>
                                                    <li class="sparks-info">
                                                        <h5 style="margin:0;">
                                                            {{(sysLabels['RemainingTotalAmount'])?sysLabels['RemainingTotalAmount'].Caption:'RemainingTotalAmount'}}
                                                            <span class="txt-color-greenDark">
                                                                <i class="fa fa-minus"></i>
                                                                &nbsp;{{paidAmount.toFixed(3)}}
                                                            </span>
                                                        </h5>

                                                    </li>
                                                </ul>
                                            </div>
                                        </div>

                                        <div class="text-muted widget-footer-footer">
                                            <div class="row" style="font-size:14px;">
                                                <div class="col-sm-4">
                                                    <strong>
                                                        <input type="checkbox" [(ngModel)]="serviceCharge"
                                                            style="margin-top:0" class="m-r-5"
                                                            [disabled]="selectedInvoice.SalesInvoiceStatusID === 'Printed' || selectedInvoice.SalesInvoiceStatusID === 'Rejected'"
                                                            [ngStyle]="{'cursor': (selectedInvoice.SalesInvoiceStatusID === 'Printed' || selectedInvoice.SalesInvoiceStatusID === 'Rejected') ? 'no-drop' : 'auto'}" />
                                                        {{(sysLabels['Service Charge'])?
                                                        sysLabels['Service Charge'].Caption:'Service Charge'}}
                                                    </strong>
                                                </div>
                                                <div class="col-sm-4 text-center">
                                                    <strong>{{(sysLabels['Discount'])?sysLabels['Discount'].Caption:'Discount'}}:</strong>
                                                    {{selectedInvoice.DiscountTotal ?
                                                    selectedInvoice.DiscountTotal : 0.000}} $
                                                </div>
                                                <div class="col-sm-4 text-right">
                                                    <strong>{{(sysLabels['Total Tax'])?
                                                        sysLabels['Total Tax'].Caption:'Total Tax'}}:</strong>
                                                    {{selectedInvoice.TotalTax ?
                                                    selectedInvoice.TotalTax : 0.000}} $
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="visible-xs"><br /><br /></div>
                    <div class="col-sm-7 pos-content-right">
                        <div class="trio-window trio-window-color-blue">

                            <header>
                                <h3>{{(sysLabels['Products']) ? sysLabels['Products'].Caption :'Products'}}
                                    <i class="fa fa-refresh m-l-5 fa-spin" aria-hidden="true" *ngIf="loading"></i>
                                </h3>
                                <div class="widget-toolbar smart-form" role="menu">
                                    <label class="input">
                                        <i class="icon-append fa fa-times-circle pointer" *ngIf="searchProduct"
                                            style="color:#000" (click)="searchProduct = ''"></i>
                                        <i class="icon-append fa fa-search border-left pointer" style="color:#000"
                                            *ngIf="!searchProduct"></i>

                                        <input type="text"
                                            placeholder="{{(sysLabels['Search']) ? sysLabels['Search'].Caption : 'Search'}}"
                                            [(ngModel)]="searchProduct" (keyup.enter)="searchProducts(searchProduct)">
                                    </label>
                                </div>
                            </header>

                            <div class="column-flex full-flex" style="max-height: calc(100% - 30px)">
                                <div class="row widget-body-toolbar p-t-10">
                                    <div class="col-lg-3 row-category-list" *ngFor="let categorie of categories">
                                        <div class="btn m-7 prod-desc-class"
                                            [ngClass]="{'btn-danger-light': categorie.CategoryID == selectedCategory, 'background-color': categorie.CategoryID != selectedCategory}"
                                            (click)="getProducts(categorie.CategoryID)" style="width: 100%;">
                                            <img class="img-size" [alt]="categorie?.Description" width="25px"
                                                height="25px"
                                                [src]="categorie?.Image ? 'data:image/jpeg;base64,' + categorie.Image : 'assets/default.webp'"
                                                (error)="categorie.Image = 'assets/default.webp'" />
                                            {{ currentLanguage == 1 ? categorie.DescriptionEn : categorie.DescriptionAr
                                            }}
                                        </div>
                                    </div>
                                </div>

                                <div class="row overflow-class" *ngIf="!message">
                                    <div class="col-lg-6 " style="width: fit-content;"
                                        *ngFor="let product of (newProducts.length > 0 ? newProducts : products)">
                                        <div class="">
                                            <div class="list-item">
                                                <span class="prod-price">{{product.SalesPrice}} /
                                                    {{product.UOMDescription}}</span>
                                                <div (click)="addItemOrGroup(product)" class="prod-image">
                                                    <img [src]="product.Image" style=" object-fit: cover;" alt="product"
                                                        width="100%" height="100%"
                                                        (error)="product.Image = 'assets/default.webp'" />
                                                </div>
                                                <div style="display: flex;align-items: center;justify-content: center;">
                                                    <div (click)="addItemOrGroup(product)"
                                                        class="prod-desc prod-desc-class"
                                                        title="{{product.DescriptionEn}}" aria-label="Details">
                                                        {{ currentLanguage == 1 ? product.DescriptionEn :
                                                        product.DescriptionAr }}
                                                    </div>
                                                    <i class="fa fa-caret-down txt-color-dangerLight"
                                                        style="padding: 10px;" (click)="openMenuDrilldown(product)"
                                                        title="Details" aria-hidden="true"></i>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row overflow-class product-search-empty" *ngIf="message">
                                    <div class="col-lg-6 " style="width: fit-content;">
                                        <h1 style="color: red;">{{message}}</h1>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- END #MAIN CONTENT -->
            <div style="display: none;" id="agrrement-section" class="trio-window trio-window-color-blueLight">
                <header>
                    <img [src]="'data:image/jpeg;base64,' + userInfo.CompanyInfo?.Logo" />
                    <div>
                        <div class="center-text">{{userInfo.SalesDivision?.DivisionDescription}},
                            {{userInfo.SalesDivision?.SiteDescription}}</div>
                        <div class="center-text">{{userInfo.SalesDivision?.StoreDescription}}</div>
                        <table class="info-table">
                            <tr>
                                <td><strong>{{(sysLabels['Mobile']) ? sysLabels['Mobile'].Caption : 'Mobile'}}:</strong>
                                </td>
                                <td>{{selectedInvoice?.Mobile}}</td>
                            </tr>
                            <tr>
                                <td><strong>{{(sysLabels['Invoice']) ? sysLabels['Invoice'].Caption : 'Invoice'}}
                                        #:</strong></td>
                                <td>{{selectedInvoice?.ID}}</td>
                            </tr>
                            <tr>
                                <td><strong>{{(sysLabels['Date']) ? sysLabels['Date'].Caption : 'Date'}}:</strong></td>
                                <td>{{selectedInvoice?.CreatedDate | date:'shortDate'}}</td>
                            </tr>
                            <tr>
                                <td><strong>{{(sysLabels['Customer']) ? sysLabels['Customer'].Caption :
                                        'Customer'}}:</strong></td>
                                <td>{{selectedInvoice?.CustDescription}}</td>
                            </tr>
                        </table>
                        <div class="cashier-info">
                            <p><strong>{{(sysLabels['Cashier']) ? sysLabels['Cashier'].Caption : 'Cashier'}}:</strong>
                                {{selectedInvoice?.CashierDescription}}</p>
                        </div>

                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>{{(sysLabels['Product']) ? sysLabels['Product'].Caption : 'Product'}}</th>
                                    <th>{{(sysLabels['Qty']) ? sysLabels['Qty'].Caption : 'Qty'}}</th>
                                    <th>{{(sysLabels['Amount']) ? sysLabels['Amount'].Caption : 'Amount'}}</th>
                                    <th>{{(sysLabels['Total']) ? sysLabels['Total'].Caption : 'Total'}}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let Products of selectedInvoiceProducts">
                                    <td>{{Products.ID}}</td>
                                    <td>{{Products.Description}}</td>
                                    <td>{{Products.Qty}}</td>
                                    <td>{{Products.SalesPrice}}</td>
                                    <td>{{Products.NetTotalAfterTax}}</td>
                                </tr>
                                <tr>
                                    <td colspan="5">
                                        <hr>
                                    </td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td>{{currentLanguage == 1 ? 'Total Amount' : 'المبلغ الإجمالي'}}</td>
                                    <td>{{selectedInvoice?.TotalAmount}}</td>
                                    <td>{{selectedInvoice?.CurrencyID}}</td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td>{{(sysLabels['Discount']) ? sysLabels['Discount'].Caption : 'Discount'}}</td>
                                    <td>{{selectedInvoice?.DiscountTotal}}</td>
                                    <td>{{selectedInvoice?.CurrencyID}}</td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td>{{(sysLabels['Vat']) ? sysLabels['Vat'].Caption : 'Vat'}}</td>
                                    <td>{{selectedInvoice?.TotalTax}}</td>
                                    <td>{{selectedInvoice?.CurrencyID}}</td>
                                </tr>
                                <tr style="font-weight: bold;">
                                    <td></td>
                                    <td></td>
                                    <td>{{(sysLabels['Net Total']) ? sysLabels['Net Total'].Caption : 'Net Total'}}</td>
                                    <td>{{selectedInvoice?.NetTotalAfterTax}}</td>
                                    <td>{{selectedInvoice?.CurrencyID}}</td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="qrcodeImage">
                            <qrcode [qrdata]="'https://github.com/Cordobo/angularx-qrcode'" [allowEmptyString]="true"
                                [ariaLabel]="'QR Code image with the following content...'" [cssClass]="'center'"
                                [colorDark]="'#000000ff'" [colorLight]="'#ffffffff'" [elementType]="'canvas'"
                                [errorCorrectionLevel]="'M'" [imageHeight]="75" [imageWidth]="75" [margin]="4"
                                [scale]="1" [title]="'A custom title attribute'" [width]="100"></qrcode>
                        </div>
                        <div class="center-text m-t-60">{{currentLanguage == 1 ?
                            'Thanks for your visit' : 'شكرا لزيارتكم'}}</div>
                    </div>
                </header>
            </div>
        </div>
        <!-- END #MAIN PANEL -->
    </div>
</div>
<footer style="margin-left: 20px;" dir="ltr">
    <div style="color:#666">
        <div>
            &copy;{{currentYear}}
            <a target="_blank" href="https://triosuite.com/">
                <span>
                    <strong>
                        <span style="color:#494949">Trio</span><span style="color:#01a4ef">3</span>
                        <span style="color:#f15023">6</span>
                        <span style="color:#7fba00">5</span>
                    </strong>
                </span>
            </a>
            <i>
                (v. {{version}})
            </i>, All Rights Reserved.
            <br>
            <span style="font-size:11px" class="ng-star-inserted">Powered by <a href="https://triosuite.com/"
                    target="_blank">Triosuite</a>
                technology
            </span>
        </div>
    </div>
</footer>